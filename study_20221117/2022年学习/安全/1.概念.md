#### 安全原则

CIA 三元组

- 机密性 C  （不可见）
  - 定义：确保数据只被授权的主体访问，不被任何未被授权的主体访问
  - 保护技术：访问控制、安全模型、加密、隔离、混淆、隐藏
  - 破解技术：破解加解密算法、去逆向混淆代码
- 完整性 A  （不可改）
  - 定义：确保数据只被授权的主体修改
  - 保护技术：访问控制、加密、签名、审计日志
- 可用性 I  （可读）
  - 定义：确保数据能被授权的主体访问到
  - 保护技术：机房建设、多地冗余、服务备份、冗余、降低响应延迟、处理海量数据、峰值扩容、dos攻击



#### 黄金法则

- 认证、识别  （事前防御）
  - 识别是你是谁，知道你的身份，认证是如何证明你是谁
  - 认证大致分为三类，安全等级由弱变强
    - 你知道什么？密码、密保问题
    - 你拥有什么？门禁卡、安全令牌
    - 你是什么？生物特征、指纹、人脸、虹膜
  - 可信的身份认证是建立安全保障体系的第一步
- 授权  （事中防御）
  - 授权强调的是你能做什么？你能做多少？
  - 授权主要分为两种方式
    - 每次操作都进行审批和确认，很麻烦，比如签证
    - 自动化授权完成更快的响应，如自主访问控制、强制访问控制
  - 权限控制、会话检测、
- 审计、问责 （事后防御）
  - 审计是你做了什么？问责是你做了某些异常操作后，通过证据确认责任。
  - 审计和问责共同的基础是日志，审计是通过日志还原用户操作，审计是通过日志完整性确保还原操作的可信度。
  - 异常检测、机器学习、日志查看

**安全是严格遵从“木桶原理”的领域，只专注于某一个方向必然无法产出最优的结果。因此，我们一定要积极寻找短板，全面发展。**

**安全没有“银弹”。只有当可用性接近 0 时，我们才有可能接近 100% 的安全。**





#### 加密算法

- 对称加密算法
  - DES（数据加密标准-美国）
    - 早期加密算法，56位，暴力破解大概24小时以内
  - IDEA （国际数据加密算法-瑞士）
    - 秘钥长度128位，没有专利的限制，可以随便使用
  - AES （高级加密标准-美国）
    - DES被破解后，提出了AES，提供128位、192位、256位三种加密长度，一般选择128位保证性能
    - 在算力没有突破前，AES在可预期内是安全的
    - AES是国际上最认可的密码学算法
  - 国密SM1
    - 算法未公开，属于国家机密，128位
  - 国密SM4
    - 算法公开，可以自己使用，128位
  - 分组计算方式：ECB/CBC/CFB/OFB/CTR 常用的是CBC和CTR
  - <img src="https://static001.geekbang.org/resource/image/71/64/71f26d29081b9348c35afd8d73fb7f64.jpeg?wh=1920*1080" alt="img" style="zoom:25%;" />
- 非对称加密算法
  - 为了解决对称加密中秘钥被窃取的现象，非对称加密算法采取公钥加密，私钥解密的方式，公钥可以公开，解决了秘钥被窃取的问题
  - 除了加密，非对称算法提供了签名功能，也就是私钥加密，公钥解密，证明发送方的身份。
  - RSA
    - 根据数学难题实现：两个大质数p、q相乘的结果n很容易得到，但是根据n做质因数分解得到p、q很难
    - 性能较高，如果需要较高的加密强度，需要增加长度。
  - ECC （椭圆加密算法）
    - 根据椭圆曲线数据难题实现，椭圆曲线比大质数难度高，所以加密强度也高，100位秘钥的ECC加密强度，相当于1088位秘钥的RSA加密
    - ECC是公认加密强度最高的加密算法
  - 国密SM2
    - 也是根据椭圆曲线实现，算法公开，强度和ECC类似
  - 应用场景：数字签名用于确认发送者身份
  - <img src="https://static001.geekbang.org/resource/image/a4/a9/a433f7e6ea562496477f4330e76af5a9.jpeg?wh=1920*1080" alt="img" style="zoom:25%;" />
- 散列算法 (消息摘要算法)  
  - 特点：长度固定、不可逆、速度快
  - 消息摘要和数字签名区别：数字签名是可逆的（非对称加密），消息摘要不可逆
  - 应用场景：保证数据完整性、安全访问认证（存储密码用md5加密数据，这样除了用户都不知道密码是啥）
  - 使用散列算法时，一定要加盐，盐就是一串随机字符串，可以公开。加盐之后就算两个用户密码一样，生成的hash值也不同，同时可以增加盐值长度提高加密强度。
  - md5 
    - 生成128位摘要，比较普遍的散列算法
    - 已经被破解了，但是大部分场景，都不会有安全问题
  - SHA
    - 分为SHA-1和SHA-2两个版本
    - SHA-256是普遍认为最安全的算法，也是推荐使用的
  - 国密SM3，和SHA-256相当
- 使用场景：
  - 对称加密具备较高的安全性和性能，要优先考虑
  - 在一对多的场景中（如多人登录服务器），存在密钥分发难题的时候，我们要使用非对称加密；
  - 不需要可逆计算的时候（如存储密码），我们就使用散列算法。

<img src="https://static001.geekbang.org/resource/image/99/02/996d36025343b162484fb07d9c5c1002.jpg?wh=1920*877" alt="img" style="zoom:25%;" />

#### 身份认证

- 对外认证：单一场景下的认证
  - 用户登录认证
  
- 对内认证：多场景下的认证
  - 服务器登录、数据库登录、git登录、管理后台登录
  
- 面临的威胁
  - 没有认证环节
  - 弱密码
  - 认证信息泄露：钓鱼、拖库等威胁的方案
  
  - 设置强密码，二次支付密码
  - 手机认证代替密码登录
  - 人脸、指纹识别
  - https
  - 身份管理
  
- 单点登录
  - CAS流程
    - 用户访问应用
    - 后端应用指向认证中心
    - 用户认证
    - 认证中心返回凭据相关信息
    - 用户将凭证发送给应用
    - 应用像认证中心认证有效性
    - 完成认证
  - JWT
    - 客户端保存凭证信息，不需要服务端维护cookie或者session
  - Oauth
    - 为了解决依赖认证中心，不能注销的问题
    - 应用不再依赖认证中心，而是通过认证中心的登录信息，绑定用户信息，在应用本身创建对应账户，维护状态
    - 比如微博登录，用微信登录，实际是用微信基础信息创建了一个微博账号
  - OpenId
    - 相对于Oauth，不提供授权功能，比如应用微信支付的时候，不会获取用户头像等





#### 访问控制

- 概念：主体请求客体，授权由访问控制完成
  - 主体：请求发起者
  - 客体：请求接收方，一般是资源
  - 请求：主体发送的请求
- 机制
  - DAC：自主访问控制
    - 让客体的所有者来定义访问控制规则，比如Linux，用户可以自己操控文件的访问权限
    - 具有很高的灵活性，维护成本低，但是安全性完全取决于拥有者
  - role-BAC：基于角色的访问控制
    - 防止权限泛滥，实现最小特权原则的经典解决方案
    - 适合在管理员管理集中适合使用，管理员统一分配角色
    - 管理员针对主体制定的访问控制策略
  - rule-BAC：基于规则的访问控制
    - 制定某种规则，针对请求本身制定访问控制策略。
    - 适合在复杂场景提供访问控制。比如防火墙
    - 需要定义默认通过或者默认拒绝。比如服务器对外暴露80和443端口，所有不符合规则的都拒绝访问
  - MAC：强制访问控制
    - 基于安全级别标签的访问控制策略，一般划分四个级别：私密、私人、敏感、公开
    - 机密性不能低读、高写，完整性不能低写、高读
    - 是安全性最高的访问控制，但是实现很难，因为需要对所有数据标记，所以一般，只有政府系统使用MAC

<img src="https://static001.geekbang.org/resource/image/ab/f5/abf769050398cddd0ce91fc470ba60f5.jpeg?wh=1920*1080" alt="img" style="zoom:25%;" />



#### 威胁评估

- 步骤
  - 识别数据：识别数据的CIA被破坏后对公司的影响有多大
  - 识别攻击：明确什么样的数据有攻击价值
  - 识别漏洞



![img](https://static001.geekbang.org/resource/image/92/59/9257502be5c779db83aa493459802959.jpg?wh=1142*1114)



